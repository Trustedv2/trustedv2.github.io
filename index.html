<!DOCTYPE html>
<html>
<head>
  <title>TrustedV2 Forum</title>
  <style>
    body { background-color: white; font-family: sans-serif; }
    h1, p { color: black; }
    #main-content, #login-section, #forum-section, #user-posts-section, #chat-section {
      display: none;
    }
    .post, .user-post {
      border: 1px solid black;
      padding: 10px;
      margin: 10px 0;
    }
    textarea { width: 100%; height: 60px; }
    input, button {
      margin: 5px 0;
    }
  </style>
</head>
<body>

<div id="loading">
  <h1>Connecting to Server...</h1>
</div>

<div id="offline" style="display: none;">
  <h1>The server is offline. We will be back online.</h1>
</div>

<div id="main-content">
  <h1>TrustedV2 Forum</h1>
  <p id="random-id"></p>

  <div id="login-section">
    <h2>Login / Register</h2>
    <input type="text" id="username" placeholder="Username"><br>
    <input type="password" id="password" placeholder="Password (8+ chars)"><br>
    <button onclick="register()">Register</button>
    <button onclick="login()">Login</button>
    <button onclick="guestLogin()">Login as Guest</button>
  </div>

  <div id="forum-section">
    <h2>Create Post</h2>
    <input type="text" id="post-title" placeholder="Post Title"><br>
    <textarea id="post-message" placeholder="Write your post..."></textarea><br>
    <button onclick="createPost()">Submit Post</button>

    <h2>All Posts</h2>
    <div id="all-posts"></div>

    <button onclick="showUserPosts()">See My Posts</button>
    <button onclick="showChat()">Chat</button>
  </div>

  <div id="user-posts-section">
    <h2>Your Posts</h2>
    <div id="user-posts"></div>
    <button onclick="backToForum()">Back</button>
  </div>

  <div id="chat-section">
    <h2>Chat</h2>
    <input type="text" id="friend-name" placeholder="Friend Username"><br>
    <textarea id="chat-message" placeholder="Message..."></textarea><br>
    <button onclick="sendMessage()">Send Message</button>
    <div id="chat-box"></div>
    <button onclick="backToForum()">Back</button>
  </div>
</div>

<script>
  const maintenanceMode = false;

  if (maintenanceMode) {
    document.getElementById("loading").style.display = 'none';
    document.getElementById("offline").style.display = 'block';
  } else {
    setTimeout(() => {
      document.getElementById("loading").style.display = 'none';
      document.getElementById("main-content").style.display = 'block';
      document.getElementById("login-section").style.display = 'block';
      document.getElementById("random-id").textContent = "Your Guest ID: " + generateRandomId();
      loadPosts();
    }, 2000);
  }

  let currentUser = null;

  function generateRandomId() {
    return Math.floor(Math.random() * 90000) + 10000;
  }

  function guestLogin() {
    currentUser = "Guest";
    enterForum();
  }

  function register() {
    const user = document.getElementById("username").value;
    const pass = document.getElementById("password").value;

    if (pass.length < 8) {
      alert("Password must be at least 8 characters.");
      return;
    }

    if (localStorage.getItem("user-" + user)) {
      alert("User already exists.");
    } else {
      localStorage.setItem("user-" + user, JSON.stringify({ password: pass, friends: [] }));
      alert("Account created!");
    }
  }

  function login() {
    const user = document.getElementById("username").value;
    const pass = document.getElementById("password").value;
    const data = localStorage.getItem("user-" + user);

    if (!data) {
      alert("User does not exist.");
    } else {
      const userData = JSON.parse(data);
      if (userData.password === pass) {
        currentUser = user;
        enterForum();
      } else {
        alert("Wrong password.");
      }
    }
  }

  function enterForum() {
    document.getElementById("login-section").style.display = 'none';
    document.getElementById("forum-section").style.display = 'block';
    loadPosts();
  }

  function createPost() {
    const title = document.getElementById("post-title").value;
    const message = document.getElementById("post-message").value;
    const post = { user: currentUser, title, message, id: Date.now() };

    const posts = JSON.parse(localStorage.getItem("posts")) || [];
    posts.push(post);
    localStorage.setItem("posts", JSON.stringify(posts));

    document.getElementById("post-title").value = "";
    document.getElementById("post-message").value = "";
    loadPosts();
  }

  function loadPosts() {
    const posts = JSON.parse(localStorage.getItem("posts")) || [];
    const container = document.getElementById("all-posts");
    container.innerHTML = "";

    posts.forEach(post => {
      const div = document.createElement("div");
      div.className = "post";
      div.innerHTML = `<strong>${post.user}</strong><br><b>${post.title}</b><br>${post.message}`;
      if (post.user === currentUser) {
        div.innerHTML += `<br><button onclick="deletePost(${post.id})">Delete</button>`;
      }
      container.appendChild(div);
    });
  }

  function deletePost(postId) {
    let posts = JSON.parse(localStorage.getItem("posts")) || [];
    posts = posts.filter(post => post.id !== postId);
    localStorage.setItem("posts", JSON.stringify(posts));
    loadPosts();
  }

  function showUserPosts() {
    document.getElementById("forum-section").style.display = 'none';
    document.getElementById("user-posts-section").style.display = 'block';

    const posts = JSON.parse(localStorage.getItem("posts")) || [];
    const myPosts = posts.filter(post => post.user === currentUser);

    const container = document.getElementById("user-posts");
    container.innerHTML = "";

    myPosts.forEach(post => {
      const div = document.createElement("div");
      div.className = "user-post";
      div.innerHTML = `<b>${post.title}</b><br>${post.message}`;
      container.appendChild(div);
    });
  }

  function backToForum() {
    document.getElementById("user-posts-section").style.display = 'none';
    document.getElementById("chat-section").style.display = 'none';
    document.getElementById("forum-section").style.display = 'block';
  }

  function showChat() {
    document.getElementById("forum-section").style.display = 'none';
    document.getElementById("chat-section").style.display = 'block';
    loadChat();
  }

  function sendMessage() {
    const friend = document.getElementById("friend-name").value;
    const msg = document.getElementById("chat-message").value;

    const chatKey = `chat-${currentUser}-${friend}`;
    const messages = JSON.parse(localStorage.getItem(chatKey)) || [];
    messages.push({ from: currentUser, to: friend, text: msg });
    localStorage.setItem(chatKey, JSON.stringify(messages));

    document.getElementById("chat-message").value = "";
    loadChat();
  }

  function loadChat() {
    const friend = document.getElementById("friend-name").value;
    const chatKey = `chat-${currentUser}-${friend}`;
    const messages = JSON.parse(localStorage.getItem(chatKey)) || [];

    const box = document.getElementById("chat-box");
    box.innerHTML = "";
    messages.forEach(m => {
      const p = document.createElement("p");
      p.textContent = `${m.from}: ${m.text}`;
      box.appendChild(p);
    });
  }
</script>

</body>
</html>
